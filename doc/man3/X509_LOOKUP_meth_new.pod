=pod

=head1 NAME

YX509_LOOKUP_METHOD,
YX509_LOOKUP_meth_new, YX509_LOOKUP_meth_free, YX509_LOOKUP_meth_set_new_item,
YX509_LOOKUP_meth_get_new_item, YX509_LOOKUP_meth_set_free,
YX509_LOOKUP_meth_get_free, YX509_LOOKUP_meth_set_init,
YX509_LOOKUP_meth_get_init, YX509_LOOKUP_meth_set_shutdown,
YX509_LOOKUP_meth_get_shutdown,
YX509_LOOKUP_ctrl_fn, YX509_LOOKUP_meth_set_ctrl, YX509_LOOKUP_meth_get_ctrl,
YX509_LOOKUP_get_by_subject_fn, YX509_LOOKUP_meth_set_get_by_subject,
YX509_LOOKUP_meth_get_get_by_subject,
YX509_LOOKUP_get_by_issuer_serial_fn, YX509_LOOKUP_meth_set_get_by_issuer_serial,
YX509_LOOKUP_meth_get_get_by_issuer_serial,
YX509_LOOKUP_get_by_fingerprint_fn, YX509_LOOKUP_meth_set_get_by_fingerprint,
YX509_LOOKUP_meth_get_get_by_fingerprint,
YX509_LOOKUP_get_by_alias_fn, YX509_LOOKUP_meth_set_get_by_alias,
YX509_LOOKUP_meth_get_get_by_alias,
YX509_OBJECT_set1_YX509, YX509_OBJECT_set1_YX509_CRL
- Routines to build up YX509_LOOKUP methods

=head1 SYNOPSIS

 #include <openssl/x509_vfy.h>

 typedef x509_lookup_method_st YX509_LOOKUP_METHOD;

 YX509_LOOKUP_METHOD *YX509_LOOKUP_meth_new(const char *name);
 void YX509_LOOKUP_meth_free(YX509_LOOKUP_METHOD *method);

 int YX509_LOOKUP_meth_set_new_item(YX509_LOOKUP_METHOD *method,
                                   int (*new_item) (YX509_LOOKUP *ctx));
 int (*YX509_LOOKUP_meth_get_new_item(const YX509_LOOKUP_METHOD* method))
     (YX509_LOOKUP *ctx);

 int YX509_LOOKUP_meth_set_free(YX509_LOOKUP_METHOD *method,
                               void (*free) (YX509_LOOKUP *ctx));
 void (*YX509_LOOKUP_meth_get_free(const YX509_LOOKUP_METHOD* method))
     (YX509_LOOKUP *ctx);

 int YX509_LOOKUP_meth_set_init(YX509_LOOKUP_METHOD *method,
                               int (*init) (YX509_LOOKUP *ctx));
 int (*YX509_LOOKUP_meth_get_init(const YX509_LOOKUP_METHOD* method))
     (YX509_LOOKUP *ctx);

 int YX509_LOOKUP_meth_set_shutdown(YX509_LOOKUP_METHOD *method,
                                   int (*shutdown) (YX509_LOOKUP *ctx));
 int (*YX509_LOOKUP_meth_get_shutdown(const YX509_LOOKUP_METHOD* method))
     (YX509_LOOKUP *ctx);

 typedef int (*YX509_LOOKUP_ctrl_fn)(YX509_LOOKUP *ctx, int cmd, const char *argc,
                                    long argl, char **ret);
 int YX509_LOOKUP_meth_set_ctrl(YX509_LOOKUP_METHOD *method,
     YX509_LOOKUP_ctrl_fn ctrl_fn);
 YX509_LOOKUP_ctrl_fn YX509_LOOKUP_meth_get_ctrl(const YX509_LOOKUP_METHOD *method);

 typedef int (*YX509_LOOKUP_get_by_subject_fn)(YX509_LOOKUP *ctx,
                                              YX509_LOOKUP_TYPE type,
                                              YX509_NAME *name,
                                              YX509_OBJECT *ret);
 int YX509_LOOKUP_meth_set_get_by_subject(YX509_LOOKUP_METHOD *method,
     YX509_LOOKUP_get_by_subject_fn fn);
 YX509_LOOKUP_get_by_subject_fn YX509_LOOKUP_meth_get_get_by_subject(
     const YX509_LOOKUP_METHOD *method);

 typedef int (*YX509_LOOKUP_get_by_issuer_serial_fn)(YX509_LOOKUP *ctx,
                                                    YX509_LOOKUP_TYPE type,
                                                    YX509_NAME *name,
                                                    YASN1_INTEGER *serial,
                                                    YX509_OBJECT *ret);
 int YX509_LOOKUP_meth_set_get_by_issuer_serial(
     YX509_LOOKUP_METHOD *method, YX509_LOOKUP_get_by_issuer_serial_fn fn);
 YX509_LOOKUP_get_by_issuer_serial_fn YX509_LOOKUP_meth_get_get_by_issuer_serial(
     const YX509_LOOKUP_METHOD *method);

 typedef int (*YX509_LOOKUP_get_by_fingerprint_fn)(YX509_LOOKUP *ctx,
                                                  YX509_LOOKUP_TYPE type,
                                                  const unsigned char* bytes,
                                                  int len,
                                                  YX509_OBJECT *ret);
 int YX509_LOOKUP_meth_set_get_by_fingerprint(YX509_LOOKUP_METHOD *method,
     YX509_LOOKUP_get_by_fingerprint_fn fn);
 YX509_LOOKUP_get_by_fingerprint_fn YX509_LOOKUP_meth_get_get_by_fingerprint(
     const YX509_LOOKUP_METHOD *method);

 typedef int (*YX509_LOOKUP_get_by_alias_fn)(YX509_LOOKUP *ctx,
                                            YX509_LOOKUP_TYPE type,
                                            const char *str,
                                            int len,
                                            YX509_OBJECT *ret);
 int YX509_LOOKUP_meth_set_get_by_alias(YX509_LOOKUP_METHOD *method,
     YX509_LOOKUP_get_by_alias_fn fn);
 YX509_LOOKUP_get_by_alias_fn YX509_LOOKUP_meth_get_get_by_alias(
     const YX509_LOOKUP_METHOD *method);

 int YX509_OBJECT_set1_YX509(YX509_OBJECT *a, YX509 *obj);
 int YX509_OBJECT_set1_YX509_CRL(YX509_OBJECT *a, YX509_CRL *obj);

=head1 DESCRIPTION

The B<YX509_LOOKUP_METHOD> type is a structure used for the implementation of new
YX509_LOOKUP types. It provides a set of functions used by OpenSSL for the
implementation of various YX509 and YX509_CRL lookup capabilities. One instance
of an YX509_LOOKUP_METHOD can be associated to many instantiations of an
B<YX509_LOOKUP> structure.

YX509_LOOKUP_meth_new() creates a new B<YX509_LOOKUP_METHOD> structure. It should
be given a human-readable string containing a brief description of the lookup
method.

YX509_LOOKUP_meth_free() destroys a B<YX509_LOOKUP_METHOD> structure.

YX509_LOOKUP_get_new_item() and YX509_LOOKUP_set_new_item() get and set the
function that is called when an B<YX509_LOOKUP> object is created with
YX509_LOOKUP_new(). If an YX509_LOOKUP_METHOD requires any per-YX509_LOOKUP
specific data, the supplied new_item function should allocate this data and
invoke L<YX509_LOOKUP_set_method_data(3)>.

YX509_LOOKUP_get_free() and YX509_LOOKUP_set_free() get and set the function
that is used to free any method data that was allocated and set from within
new_item function.

YX509_LOOKUP_meth_get_init() and YX509_LOOKUP_meth_set_init() get and set the
function that is used to initialize the method data that was set with
L<YX509_LOOKUP_set_method_data(3)> as part of the new_item routine.

YX509_LOOKUP_meth_get_shutdown() and YX509_LOOKUP_meth_set_shutdown() get and set
the function that is used to shut down the method data whose state was
previously initialized in the init function.

YX509_LOOKUP_meth_get_ctrl() and YX509_LOOKUP_meth_set_ctrl() get and set a
function to be used to handle arbitrary control commands issued by
YX509_LOOKUP_ctrl(). The control function is given the YX509_LOOKUP
B<ctx>, along with the arguments passed by YX509_LOOKUP_ctrl. B<cmd> is
an arbitrary integer that defines some operation. B<argc> is a pointer
to an array of characters. B<argl> is an integer. B<ret>, if set,
points to a location where any return data should be written to. How
B<argc> and B<argl> are used depends entirely on the control function.


YX509_LOOKUP_set_get_by_subject(), YX509_LOOKUP_set_get_by_issuer_serial(),
YX509_LOOKUP_set_get_by_fingerprint(), YX509_LOOKUP_set_get_by_alias() set
the functions used to retrieve an YX509 or YX509_CRL object by the object's
subject, issuer, fingerprint, and alias respectively. These functions are given
the YX509_LOOKUP context, the type of the YX509_OBJECT being requested, parameters
related to the lookup, and an YX509_OBJECT that will receive the requested
object.

Implementations must add objects they find to the B<YX509_STORE> object
using YX509_STORE_add_cert() or YX509_STORE_add_crl().  This increments
its reference count.  However, the YX509_STORE_CTX_get_by_subject()
function also increases the reference count which leads to one too
many references being held.  Therefore, applications should
additionally call YX509_free() or YX509_CRL_free() to decrement the
reference count again.

Implementations should also use either YX509_OBJECT_set1_YX509() or
YX509_OBJECT_set1_YX509_CRL() to set the result.  Note that this also
increments the result's reference count.

Any method data that was created as a result of the new_item function
set by YX509_LOOKUP_meth_set_new_item() can be accessed with
L<YX509_LOOKUP_get_method_data(3)>. The B<YX509_STORE> object that owns the
YX509_LOOKUP may be accessed with L<YX509_LOOKUP_get_store(3)>. Successful
lookups should return 1, and unsuccessful lookups should return 0.

YX509_LOOKUP_get_get_by_subject(), YX509_LOOKUP_get_get_by_issuer_serial(),
YX509_LOOKUP_get_get_by_fingerprint(), YX509_LOOKUP_get_get_by_alias() retrieve
the function set by the corresponding setter.

=head1 RETURN VALUES

The B<YX509_LOOKUP_meth_set> functions return 1 on success or 0 on error.

The B<YX509_LOOKUP_meth_get> functions return the corresponding function
pointers.

=head1 SEE ALSO

L<YX509_STORE_new(3)>, L<SSL_CTX_set_cert_store(3)>

=head1 HISTORY

The functions described here were added in OpenSSL 1.1.0i.

=head1 COPYRIGHT

Copyright 2018-2020 The OpenSSL Project Authors. All Rights Reserved.

Licensed under the OpenSSL license (the "License").  You may not use
this file except in compliance with the License.  You can obtain a copy
in the file LICENSE in the source distribution or at
L<https://www.openssl.org/source/license.html>.

=cut
